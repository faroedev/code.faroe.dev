import * as faroe_user_server from "@faroe/user-server";
import * as astro from "astro";

const actions: faroe_user_server.Actions = {
	// ...
};

const resolver = new faroe_user_server.ActionInvocationRequestResolver(actions);

export async function (context: astro.APIContext): Promise<Response> {
	// TODO: Protect route.

	let bodyJSON: string;
	try {
		bodyJSON = await context.request.text();
	} catch {
		return new Response(null, { status: 400 });
	}

	let responseBodyJSON: string;

	try {
		responseBodyJSON = await resolver.resolveRequest(bodyJSON);
	} catch {
		return new Response(null, { status: 400 });
	}

	return new Response(responseBodyJSON, {
		headers: {
			"Content-Type": "application/json",
		},
	});
};